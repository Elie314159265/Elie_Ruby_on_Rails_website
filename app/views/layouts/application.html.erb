<!DOCTYPE html>
<html lang="ja">
  <head>
    <title><%= content_for(:title) || "Elie's Portfolio" %></title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%# Tailwind CSS (CDN) %>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: '#e0f2fe',
              secondary: '#bae6fd',
              accent: '#0284c7',
              dark: '#0f172a',
            },
            fontFamily: {
              sans: ['Helvetica Neue', 'Arial', 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', 'Meiryo', 'sans-serif'],
            },
            animation: {
              'fade-in-up': 'fadeInUp 0.8s ease-out forwards',
            },
            keyframes: {
              fadeInUp: {
                '0%': { opacity: '0', transform: 'translateY(20px)' },
                '100%': { opacity: '1', transform: 'translateY(0)' },
              }
            }
          }
        }
      }
    </script>

    <%# Google Fonts %>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />

    <%# Markdown Styles (Github Flavored Markdowné¢¨) %>
    <style>
      .markdown-body h2 { font-size: 1.5rem; font-weight: 700; margin-top: 2rem; margin-bottom: 1rem; border-bottom: 2px solid #0284c7; padding-bottom: 0.3rem; color: #1e293b; }
      .markdown-body h3 { font-size: 1.25rem; font-weight: 600; margin-top: 1.5rem; margin-bottom: 0.75rem; color: #334155; }
      .markdown-body p { margin-bottom: 1rem; line-height: 1.8; color: #334155; }
      .markdown-body ul { list-style-type: disc; padding-left: 1.5rem; margin-bottom: 1rem; color: #334155; }
      .markdown-body ol { list-style-type: decimal; padding-left: 1.5rem; margin-bottom: 1rem; color: #334155; }
      .markdown-body a { color: #0284c7; text-decoration: underline; }
      .markdown-body a:hover { color: #0369a1; }
      .markdown-body pre { background-color: #1e293b; color: #f8fafc; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; margin-bottom: 1.5rem; }
      .markdown-body code { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; background-color: #f1f5f9; padding: 0.2rem 0.4rem; border-radius: 0.25rem; color: #0f172a; font-size: 0.875em; }
      .markdown-body pre code { background-color: transparent; color: inherit; padding: 0; font-size: 1em; }
      .markdown-body blockquote { border-left: 4px solid #cbd5e1; padding-left: 1rem; color: #64748b; font-style: italic; margin-bottom: 1rem; }
      .markdown-body img { max-width: 100%; height: auto; border-radius: 0.5rem; margin: 1.5rem 0; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
    </style>

    <%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body class="font-sans flex flex-col min-h-screen" style="background-color: #e0f2fe; color: #0f172a;">

    <%# Navigation %>
    <nav class="bg-white/90 backdrop-blur-md shadow-sm sticky top-0 z-50">
      <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between h-16">
          <div class="flex items-center space-x-4">
            <%# Mobile Menu Button %>
            <button id="mobile-menu-btn" class="lg:hidden text-gray-700 hover:text-accent focus:outline-none">
              <span class="material-symbols-outlined text-3xl">menu</span>
            </button>

            <%# Desktop Sidebar Toggle Button %>
            <button id="desktop-sidebar-toggle" class="hidden lg:block text-gray-700 hover:text-accent focus:outline-none transition-colors">
              <span class="material-symbols-outlined text-2xl">menu</span>
            </button>

            <%= link_to root_path, class: "flex items-center space-x-2 group" do %>
              <span class="material-symbols-outlined text-accent text-3xl group-hover:scale-110 transition-transform"></span>
              <span class="text-xl font-bold tracking-wider text-gray-700 group-hover:text-accent transition-colors">Elie's Portfolio</span>
            <% end %>
          </div>

          <div class="hidden sm:flex sm:items-center sm:space-x-8">
            <%= link_to "Home", root_path, class: "bg-accent text-white hover:bg-sky-700 px-4 py-2 rounded-full text-sm font-medium transition-all shadow-md hover:shadow-lg" %>
            <%= link_to "About", "/guides/ruby_overview", class: "bg-accent text-white hover:bg-sky-700 px-4 py-2 rounded-full text-sm font-medium transition-all shadow-md hover:shadow-lg" %>
            <%= link_to "Works", "/guides/ruby_overview", class: "bg-accent text-white hover:bg-sky-700 px-4 py-2 rounded-full text-sm font-medium transition-all shadow-md hover:shadow-lg" %>
            <%= link_to "Blog", "/guides/ruby_overview", class: "bg-accent text-white hover:bg-sky-700 px-4 py-2 rounded-full text-sm font-medium transition-all shadow-md hover:shadow-lg" %>
          </div>
        </div>
      </div>
    </nav>

    <%# Mobile Sidebar Overlay %>
    <div id="mobile-sidebar-overlay" class="fixed inset-0 bg-black/50 z-40 lg:hidden hidden"></div>

    <%# Mobile Sidebar %>
    <aside id="mobile-sidebar" class="fixed left-0 top-16 bottom-0 w-64 bg-white shadow-2xl z-50 lg:hidden transform -translate-x-full transition-transform duration-300 overflow-y-auto">
      <nav class="p-6 space-y-6">
        <%# Guides Section %>
        <div>
          <h3 class="text-xs font-bold uppercase tracking-wider text-gray-500 mb-3 flex items-center">
            <span class="material-symbols-outlined text-sm mr-1">book</span>
            Guides
          </h3>
          <ul class="space-y-2">
            <%= link_to "/guides/ruby_overview", class: "flex items-center text-sm text-gray-700 hover:text-accent hover:bg-sky-50 px-3 py-2 rounded-lg transition-all #{request.path == '/guides/ruby_overview' ? 'bg-sky-100 text-accent font-medium' : ''}" do %>
              <span class="material-symbols-outlined text-lg mr-2">visibility</span>
              Ruby Overview
            <% end %>
            <%= link_to "/guides/ruby_controller", class: "flex items-center text-sm text-gray-700 hover:text-accent hover:bg-sky-50 px-3 py-2 rounded-lg transition-all #{request.path == '/guides/ruby_controller' ? 'bg-sky-100 text-accent font-medium' : ''}" do %>
              <span class="material-symbols-outlined text-lg mr-2">settings</span>
              Ruby Controller
            <% end %>
            <%= link_to "/guides/ruby_view", class: "flex items-center text-sm text-gray-700 hover:text-accent hover:bg-sky-50 px-3 py-2 rounded-lg transition-all #{request.path == '/guides/ruby_view' ? 'bg-sky-100 text-accent font-medium' : ''}" do %>
              <span class="material-symbols-outlined text-lg mr-2">pageview</span>
              Ruby View
            <% end %>
            <%= link_to "/guides/ruby_rich_view", class: "flex items-center text-sm text-gray-700 hover:text-accent hover:bg-sky-50 px-3 py-2 rounded-lg transition-all #{request.path == '/guides/ruby_rich_view' ? 'bg-sky-100 text-accent font-medium' : ''}" do %>
              <span class="material-symbols-outlined text-lg mr-2">web</span>
              Ruby Rich View
            <% end %>
            <%= link_to "/guides/ruby_model", class: "flex items-center text-sm text-gray-700 hover:text-accent hover:bg-sky-50 px-3 py-2 rounded-lg transition-all #{request.path == '/guides/ruby_model' ? 'bg-sky-100 text-accent font-medium' : ''}" do %>
              <span class="material-symbols-outlined text-lg mr-2">database</span>
              Ruby Model
            <% end %>
          </ul>
        </div>

        <%# Rails Doc Section %>
        <div>
          <h3 class="text-xs font-bold uppercase tracking-wider text-gray-500 mb-3 flex items-center">
            <span class="material-symbols-outlined text-sm mr-1">description</span>
            Rails Doc
          </h3>
          <ul class="space-y-2">
            <%= link_to "/rails_doc/routing", class: "flex items-center text-sm text-gray-700 hover:text-accent hover:bg-sky-50 px-3 py-2 rounded-lg transition-all #{request.path == '/rails_doc/routing' ? 'bg-sky-100 text-accent font-medium' : ''}" do %>
              <span class="material-symbols-outlined text-lg mr-2">route</span>
              Routing
            <% end %>
            <%= link_to "/rails_doc/migration", class: "flex items-center text-sm text-gray-700 hover:text-accent hover:bg-sky-50 px-3 py-2 rounded-lg transition-all #{request.path == '/rails_doc/migration' ? 'bg-sky-100 text-accent font-medium' : ''}" do %>
              <span class="material-symbols-outlined text-lg mr-2">upgrade</span>
              Migration
            <% end %>
            <%= link_to "/rails_doc/active_record", class: "flex items-center text-sm text-gray-700 hover:text-accent hover:bg-sky-50 px-3 py-2 rounded-lg transition-all #{request.path == '/rails_doc/active_record' ? 'bg-sky-100 text-accent font-medium' : ''}" do %>
              <span class="material-symbols-outlined text-lg mr-2">storage</span>
              Active Record
            <% end %>
          </ul>
        </div>

        <%# MVC Section %>
        <div>
          <h3 class="text-xs font-bold uppercase tracking-wider text-gray-500 mb-3 flex items-center">
            <span class="material-symbols-outlined text-sm mr-1">account_tree</span>
            MVC
          </h3>
          <ul class="space-y-2">
            <%= link_to "/mvc/index", class: "flex items-center text-sm text-gray-700 hover:text-accent hover:bg-sky-50 px-3 py-2 rounded-lg transition-all #{request.path == '/mvc/index' ? 'bg-sky-100 text-accent font-medium' : ''}" do %>
              <span class="material-symbols-outlined text-lg mr-2">home</span>
              MVC Index
            <% end %>
            <%= link_to "/mvc/controller", class: "flex items-center text-sm text-gray-700 hover:text-accent hover:bg-sky-50 px-3 py-2 rounded-lg transition-all #{request.path == '/mvc/controller' ? 'bg-sky-100 text-accent font-medium' : ''}" do %>
              <span class="material-symbols-outlined text-lg mr-2">settings_applications</span>
              MVC Controller
            <% end %>
            <%= link_to "/mvc/model", class: "flex items-center text-sm text-gray-700 hover:text-accent hover:bg-sky-50 px-3 py-2 rounded-lg transition-all #{request.path == '/mvc/model' ? 'bg-sky-100 text-accent font-medium' : ''}" do %>
              <span class="material-symbols-outlined text-lg mr-2">table_chart</span>
              MVC Model
            <% end %>
            <%= link_to "/mvc/view", class: "flex items-center text-sm text-gray-700 hover:text-accent hover:bg-sky-50 px-3 py-2 rounded-lg transition-all #{request.path == '/mvc/view' ? 'bg-sky-100 text-accent font-medium' : ''}" do %>
              <span class="material-symbols-outlined text-lg mr-2">grid_view</span>
              MVC View
            <% end %>
          </ul>
        </div>
      </nav>
    </aside>

    <%# Flash Messages %>
    <% flash.each do |key, value| %>
      <div class="max-w-5xl mx-auto px-4 mt-4 animate-fade-in-up">
        <% color_class = key == 'notice' ? 'bg-sky-100 text-sky-800 border-sky-200' : 'bg-red-100 text-red-800 border-red-200' %>
        <div class="<%= color_class %> px-4 py-3 rounded-lg border flex items-center shadow-sm">
          <span class="material-symbols-outlined mr-2 text-lg"><%= key == 'notice' ? 'check_circle' : 'error' %></span>
          <span class="text-sm font-medium"><%= value %></span>
        </div>
      </div>
    <% end %>

    <%# Main Content with Sidebar %>
    <div class="flex-grow flex">
      <%# Left Sidebar - Page Navigation %>
      <aside id="desktop-sidebar" class="hidden lg:block w-64 bg-white/80 backdrop-blur-sm border-r border-sky-100 overflow-y-auto sticky top-16 h-[calc(100vh-4rem)] transition-all duration-300">
        <nav class="p-6 space-y-6">
          <%# Guides Section %>
          <div>
            <h3 class="text-xs font-bold uppercase tracking-wider text-gray-500 mb-3 flex items-center">
              
              Guides
            </h3>
            <ul class="space-y-2">
              <%= link_to "/guides/ruby_overview", class: "flex items-center text-sm text-gray-700 hover:text-accent hover:bg-sky-50 px-3 py-2 rounded-lg transition-all #{request.path == '/guides/ruby_overview' ? 'bg-sky-100 text-accent font-medium' : ''}" do %>
                
                Ruby Overview
              <% end %>
              <%= link_to "/guides/ruby_controller", class: "flex items-center text-sm text-gray-700 hover:text-accent hover:bg-sky-50 px-3 py-2 rounded-lg transition-all #{request.path == '/guides/ruby_controller' ? 'bg-sky-100 text-accent font-medium' : ''}" do %>
                
                Ruby Controller
              <% end %>
              <%= link_to "/guides/ruby_view", class: "flex items-center text-sm text-gray-700 hover:text-accent hover:bg-sky-50 px-3 py-2 rounded-lg transition-all #{request.path == '/guides/ruby_view' ? 'bg-sky-100 text-accent font-medium' : ''}" do %>
                
                Ruby View
              <% end %>
              <%= link_to "/guides/ruby_rich_view", class: "flex items-center text-sm text-gray-700 hover:text-accent hover:bg-sky-50 px-3 py-2 rounded-lg transition-all #{request.path == '/guides/ruby_rich_view' ? 'bg-sky-100 text-accent font-medium' : ''}" do %>
                
                Ruby Rich View
              <% end %>
              <%= link_to "/guides/ruby_model", class: "flex items-center text-sm text-gray-700 hover:text-accent hover:bg-sky-50 px-3 py-2 rounded-lg transition-all #{request.path == '/guides/ruby_model' ? 'bg-sky-100 text-accent font-medium' : ''}" do %>
                
                Ruby Model
              <% end %>
            </ul>
          </div>

          <%# Rails Doc Section %>
          <div>
            <h3 class="text-xs font-bold uppercase tracking-wider text-gray-500 mb-3 flex items-center">
              
              Rails Doc
            </h3>
            <ul class="space-y-2">
              <%= link_to "/rails_doc/routing", class: "flex items-center text-sm text-gray-700 hover:text-accent hover:bg-sky-50 px-3 py-2 rounded-lg transition-all #{request.path == '/rails_doc/routing' ? 'bg-sky-100 text-accent font-medium' : ''}" do %>
                
                Routing
              <% end %>
              <%= link_to "/rails_doc/migration", class: "flex items-center text-sm text-gray-700 hover:text-accent hover:bg-sky-50 px-3 py-2 rounded-lg transition-all #{request.path == '/rails_doc/migration' ? 'bg-sky-100 text-accent font-medium' : ''}" do %>
                
                Migration
              <% end %>
              <%= link_to "/rails_doc/active_record", class: "flex items-center text-sm text-gray-700 hover:text-accent hover:bg-sky-50 px-3 py-2 rounded-lg transition-all #{request.path == '/rails_doc/active_record' ? 'bg-sky-100 text-accent font-medium' : ''}" do %>
                
                Active Record
              <% end %>
            </ul>
          </div>

          <%# MVC Section %>
          <div>
            <h3 class="text-xs font-bold uppercase tracking-wider text-gray-500 mb-3 flex items-center">
              
              MVC
            </h3>
            <ul class="space-y-2">
              <%= link_to "/mvc/index", class: "flex items-center text-sm text-gray-700 hover:text-accent hover:bg-sky-50 px-3 py-2 rounded-lg transition-all #{request.path == '/mvc/index' ? 'bg-sky-100 text-accent font-medium' : ''}" do %>
                
                MVC Index
              <% end %>
              <%= link_to "/mvc/controller", class: "flex items-center text-sm text-gray-700 hover:text-accent hover:bg-sky-50 px-3 py-2 rounded-lg transition-all #{request.path == '/mvc/controller' ? 'bg-sky-100 text-accent font-medium' : ''}" do %>
                
                MVC Controller
              <% end %>
              <%= link_to "/mvc/model", class: "flex items-center text-sm text-gray-700 hover:text-accent hover:bg-sky-50 px-3 py-2 rounded-lg transition-all #{request.path == '/mvc/model' ? 'bg-sky-100 text-accent font-medium' : ''}" do %>
                
                MVC Model
              <% end %>
              <%= link_to "/mvc/view", class: "flex items-center text-sm text-gray-700 hover:text-accent hover:bg-sky-50 px-3 py-2 rounded-lg transition-all #{request.path == '/mvc/view' ? 'bg-sky-100 text-accent font-medium' : ''}" do %>
                
                MVC View
              <% end %>
            </ul>
          </div>
        </nav>
      </aside>

      <%# Main Content Area %>
      <main class="flex-grow w-full max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
        <%= yield %>
      </main>
    </div>

    <%# Footer %>
    <footer class="bg-white mt-auto py-8 border-t border-sky-100">
      <div class="max-w-5xl mx-auto px-4 text-center">
        <p class="text-gray-400 text-sm">
          &copy; <%= Time.current.year %> Elie's Ruby on Rails Portfolio. <br class="sm:hidden">
          All rights reserved.
        </p>
      </div>
    </footer>

    <%# Sidebar Toggle Script %>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Mobile Sidebar Elements
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mobileSidebar = document.getElementById('mobile-sidebar');
        const mobileOverlay = document.getElementById('mobile-sidebar-overlay');

        // Desktop Sidebar Elements
        const desktopToggleBtn = document.getElementById('desktop-sidebar-toggle');
        const desktopSidebar = document.getElementById('desktop-sidebar');

        // Mobile Sidebar Toggle
        function toggleMobileSidebar() {
          mobileSidebar.classList.toggle('-translate-x-full');
          mobileOverlay.classList.toggle('hidden');
        }

        if (mobileMenuBtn) {
          mobileMenuBtn.addEventListener('click', toggleMobileSidebar);
        }

        if (mobileOverlay) {
          mobileOverlay.addEventListener('click', toggleMobileSidebar);
        }

        // Close mobile sidebar when a link is clicked
        if (mobileSidebar) {
          const sidebarLinks = mobileSidebar.querySelectorAll('a');
          sidebarLinks.forEach(link => {
            link.addEventListener('click', function() {
              mobileSidebar.classList.add('-translate-x-full');
              mobileOverlay.classList.add('hidden');
            });
          });
        }

        // Desktop Sidebar Toggle with localStorage
        function toggleDesktopSidebar() {
          if (desktopSidebar.classList.contains('lg:block')) {
            // Hide sidebar
            desktopSidebar.classList.remove('lg:block');
            desktopSidebar.classList.add('lg:hidden');
            localStorage.setItem('sidebarCollapsed', 'true');
          } else {
            // Show sidebar
            desktopSidebar.classList.remove('lg:hidden');
            desktopSidebar.classList.add('lg:block');
            localStorage.setItem('sidebarCollapsed', 'false');
          }
        }

        // Restore sidebar state from localStorage
        const sidebarCollapsed = localStorage.getItem('sidebarCollapsed');
        if (sidebarCollapsed === 'true' && desktopSidebar) {
          desktopSidebar.classList.remove('lg:block');
          desktopSidebar.classList.add('lg:hidden');
        }

        if (desktopToggleBtn) {
          desktopToggleBtn.addEventListener('click', toggleDesktopSidebar);
        }
      });
    </script>

  </body>
</html>
